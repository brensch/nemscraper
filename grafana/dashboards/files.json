{
    "annotations": {
        "list": [
            {
                "builtIn": 1,
                "datasource": {
                    "type": "grafana",
                    "uid": "-- Grafana --"
                },
                "enable": true,
                "hide": true,
                "iconColor": "rgba(0, 211, 255, 1)",
                "name": "Annotations & Alerts",
                "type": "dashboard"
            }
        ]
    },
    "editable": true,
    "fiscalYearStartMonth": 0,
    "graphTooltip": 0,
    "id": 2,
    "links": [],
    "panels": [
        {
            "datasource": {
                "type": "motherduck-duckdb-datasource",
                "uid": "P18CE15CC9D3BAB28"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "thresholds"
                    },
                    "decimals": 3,
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "red"
                            },
                            {
                                "color": "green",
                                "value": 1
                            }
                        ]
                    },
                    "unit": "percentunit"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 5,
                "w": 6,
                "x": 0,
                "y": 0
            },
            "id": 7,
            "options": {
                "colorMode": "value",
                "graphMode": "area",
                "justifyMode": "auto",
                "orientation": "auto",
                "percentChangeColorMode": "standard",
                "reduceOptions": {
                    "calcs": [
                        "lastNotNull"
                    ],
                    "fields": "",
                    "values": false
                },
                "showPercentChange": false,
                "textMode": "auto",
                "wideLayout": true
            },
            "pluginVersion": "12.0.1",
            "targets": [
                {
                    "datasource": {
                        "type": "motherduck-duckdb-datasource",
                        "uid": "P18CE15CC9D3BAB28"
                    },
                    "editorMode": "code",
                    "format": 1,
                    "rawQuery": true,
                    "rawSql": "SELECT\r\n  CASE \r\n    WHEN total_downloaded = 0 THEN 0 \r\n    ELSE total_processed / total_downloaded \r\n  END AS percent_complete\r\nFROM (\r\n  SELECT\r\n    (SELECT count(*) \r\n     FROM read_parquet(\r\n       '/data/history/downloaded/date=*/**/*.parquet',\r\n       union_by_name => TRUE\r\n     )\r\n    )                     AS total_downloaded,\r\n    (SELECT count(*) \r\n     FROM read_parquet(\r\n       '/data/history/processed/date=*/**/*.parquet',\r\n       union_by_name => TRUE\r\n     )\r\n    )                     AS total_processed\r\n) AS counts;\r\n",
                    "refId": "A",
                    "sql": {
                        "columns": [
                            {
                                "parameters": [],
                                "type": "function"
                            }
                        ],
                        "groupBy": [
                            {
                                "property": {
                                    "type": "string"
                                },
                                "type": "groupBy"
                            }
                        ],
                        "limit": 50
                    }
                }
            ],
            "title": "Percent Processed",
            "type": "stat"
        },
        {
            "datasource": {
                "type": "motherduck-duckdb-datasource",
                "uid": "P18CE15CC9D3BAB28"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "thresholds"
                    },
                    "custom": {
                        "align": "auto",
                        "cellOptions": {
                            "type": "auto"
                        },
                        "inspect": false
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green"
                            },
                            {
                                "color": "red",
                                "value": 80
                            }
                        ]
                    }
                },
                "overrides": []
            },
            "gridPos": {
                "h": 5,
                "w": 6,
                "x": 6,
                "y": 0
            },
            "id": 5,
            "options": {
                "cellHeight": "sm",
                "footer": {
                    "countRows": false,
                    "fields": "",
                    "reducer": [
                        "sum"
                    ],
                    "show": false
                },
                "showHeader": true
            },
            "pluginVersion": "12.0.1",
            "targets": [
                {
                    "editorMode": "code",
                    "format": 1,
                    "rawQuery": true,
                    "rawSql": "SELECT\n  'Downloaded' AS state,\n  COUNT(*) AS total_count\nFROM read_parquet('/data/history/downloaded/date=*/**/*.parquet', union_by_name = TRUE)\nUNION ALL\nSELECT\n  'Processed' AS state,\n  COUNT(*) AS total_count\nFROM read_parquet('/data/history/processed/date=*/**/*.parquet', union_by_name = TRUE)\nORDER BY state;",
                    "refId": "A",
                    "sql": {
                        "columns": [
                            {
                                "parameters": [],
                                "type": "function"
                            }
                        ],
                        "groupBy": [
                            {
                                "property": {
                                    "type": "string"
                                },
                                "type": "groupBy"
                            }
                        ],
                        "limit": 50
                    }
                }
            ],
            "title": "All-Time Totals",
            "type": "table"
        },
        {
            "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "thresholds"
                    },
                    "custom": {
                        "align": "auto",
                        "cellOptions": {
                            "type": "auto"
                        },
                        "inspect": false
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green"
                            },
                            {
                                "color": "red",
                                "value": 80
                            }
                        ]
                    }
                },
                "overrides": [
                    {
                        "matcher": {
                            "id": "byName",
                            "options": "Value"
                        },
                        "properties": [
                            {
                                "id": "unit",
                                "value": "decbytes"
                            }
                        ]
                    }
                ]
            },
            "gridPos": {
                "h": 5,
                "w": 12,
                "x": 12,
                "y": 0
            },
            "id": 15,
            "options": {
                "cellHeight": "sm",
                "footer": {
                    "countRows": false,
                    "fields": "",
                    "reducer": [
                        "sum"
                    ],
                    "show": false
                },
                "showHeader": true,
                "sortBy": [
                    {
                        "desc": true,
                        "displayName": "Value"
                    }
                ]
            },
            "pluginVersion": "12.0.1",
            "targets": [
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "PBFA97CFB590B2093"
                    },
                    "editorMode": "code",
                    "exemplar": false,
                    "expr": "max by (dir) (assets_directory_size_bytes)\r\n",
                    "format": "table",
                    "instant": true,
                    "legendFormat": "__auto",
                    "range": false,
                    "refId": "A"
                }
            ],
            "title": "Directory Sizes",
            "type": "table"
        },
        {
            "datasource": {
                "type": "motherduck-duckdb-datasource",
                "uid": "P18CE15CC9D3BAB28"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "palette-classic"
                    },
                    "custom": {
                        "axisBorderShow": false,
                        "axisCenteredZero": false,
                        "axisColorMode": "text",
                        "axisLabel": "",
                        "axisPlacement": "auto",
                        "barAlignment": 0,
                        "barWidthFactor": 0.6,
                        "drawStyle": "line",
                        "fillOpacity": 0,
                        "gradientMode": "none",
                        "hideFrom": {
                            "legend": false,
                            "tooltip": false,
                            "viz": false
                        },
                        "insertNulls": false,
                        "lineInterpolation": "linear",
                        "lineWidth": 1,
                        "pointSize": 5,
                        "scaleDistribution": {
                            "type": "linear"
                        },
                        "showPoints": "auto",
                        "spanNulls": false,
                        "stacking": {
                            "group": "A",
                            "mode": "none"
                        },
                        "thresholdsStyle": {
                            "mode": "off"
                        }
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green"
                            },
                            {
                                "color": "red",
                                "value": 80
                            }
                        ]
                    }
                },
                "overrides": []
            },
            "gridPos": {
                "h": 6,
                "w": 12,
                "x": 0,
                "y": 5
            },
            "id": 6,
            "options": {
                "legend": {
                    "calcs": [],
                    "displayMode": "list",
                    "placement": "bottom",
                    "showLegend": true
                },
                "tooltip": {
                    "hideZeros": false,
                    "mode": "single",
                    "sort": "none"
                }
            },
            "pluginVersion": "12.0.1",
            "targets": [
                {
                    "datasource": {
                        "type": "motherduck-duckdb-datasource",
                        "uid": "P18CE15CC9D3BAB28"
                    },
                    "editorMode": "code",
                    "format": 0,
                    "rawQuery": true,
                    "rawSql": "SELECT\r\n  time_bucket($__interval, download_end) AS time,\r\n  count(*) AS value,\r\n  'Downloaded' AS metric\r\nFROM read_parquet(\r\n  '/data/history/downloaded/date=*/**/*.parquet',\r\n  union_by_name = TRUE\r\n)\r\nWHERE $__timeFilter(download_end)\r\nGROUP BY 1\r\n\r\nUNION ALL\r\n\r\nSELECT\r\n  time_bucket($__interval, processing_end) AS time,\r\n  count(*) AS value,\r\n  'Processed' AS metric\r\nFROM read_parquet(\r\n  '/data/history/processed/date=*/**/*.parquet',\r\n  union_by_name = TRUE\r\n)\r\nWHERE $__timeFilter(processing_end)\r\nGROUP BY 1\r\n\r\nORDER BY 1,3;\r\n",
                    "refId": "A",
                    "sql": {
                        "columns": [
                            {
                                "parameters": [],
                                "type": "function"
                            }
                        ],
                        "groupBy": [
                            {
                                "property": {
                                    "type": "string"
                                },
                                "type": "groupBy"
                            }
                        ],
                        "limit": 50
                    }
                }
            ],
            "title": "Files",
            "type": "timeseries"
        },
        {
            "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "palette-classic"
                    },
                    "custom": {
                        "axisBorderShow": false,
                        "axisCenteredZero": false,
                        "axisColorMode": "text",
                        "axisLabel": "",
                        "axisPlacement": "auto",
                        "barAlignment": 0,
                        "barWidthFactor": 0.6,
                        "drawStyle": "line",
                        "fillOpacity": 0,
                        "gradientMode": "none",
                        "hideFrom": {
                            "legend": false,
                            "tooltip": false,
                            "viz": false
                        },
                        "insertNulls": false,
                        "lineInterpolation": "linear",
                        "lineWidth": 1,
                        "pointSize": 5,
                        "scaleDistribution": {
                            "type": "linear"
                        },
                        "showPoints": "auto",
                        "spanNulls": false,
                        "stacking": {
                            "group": "A",
                            "mode": "none"
                        },
                        "thresholdsStyle": {
                            "mode": "off"
                        }
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green"
                            },
                            {
                                "color": "red",
                                "value": 80
                            }
                        ]
                    }
                },
                "overrides": []
            },
            "gridPos": {
                "h": 6,
                "w": 12,
                "x": 12,
                "y": 5
            },
            "id": 17,
            "options": {
                "legend": {
                    "calcs": [],
                    "displayMode": "list",
                    "placement": "bottom",
                    "showLegend": true
                },
                "tooltip": {
                    "hideZeros": false,
                    "mode": "single",
                    "sort": "none"
                }
            },
            "pluginVersion": "12.0.1",
            "targets": [
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "PBFA97CFB590B2093"
                    },
                    "editorMode": "code",
                    "expr": "100 * (\r\n  1 - avg by (instance) (\r\n    rate(node_cpu_seconds_total{mode=\"idle\"}[5m])\r\n  )\r\n)\r\n",
                    "instant": false,
                    "legendFormat": "__auto",
                    "range": true,
                    "refId": "A"
                }
            ],
            "title": "CPU Utilisation",
            "type": "timeseries"
        },
        {
            "datasource": {
                "type": "motherduck-duckdb-datasource",
                "uid": "P18CE15CC9D3BAB28"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "palette-classic"
                    },
                    "custom": {
                        "axisBorderShow": false,
                        "axisCenteredZero": false,
                        "axisColorMode": "text",
                        "axisLabel": "",
                        "axisPlacement": "auto",
                        "barAlignment": 0,
                        "barWidthFactor": 0.6,
                        "drawStyle": "line",
                        "fillOpacity": 0,
                        "gradientMode": "none",
                        "hideFrom": {
                            "legend": false,
                            "tooltip": false,
                            "viz": false
                        },
                        "insertNulls": false,
                        "lineInterpolation": "linear",
                        "lineWidth": 1,
                        "pointSize": 5,
                        "scaleDistribution": {
                            "type": "linear"
                        },
                        "showPoints": "auto",
                        "spanNulls": false,
                        "stacking": {
                            "group": "A",
                            "mode": "none"
                        },
                        "thresholdsStyle": {
                            "mode": "off"
                        }
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green"
                            },
                            {
                                "color": "red",
                                "value": 80
                            }
                        ]
                    },
                    "unit": "sishort"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 6,
                "w": 12,
                "x": 0,
                "y": 11
            },
            "id": 9,
            "options": {
                "legend": {
                    "calcs": [],
                    "displayMode": "list",
                    "placement": "bottom",
                    "showLegend": true
                },
                "tooltip": {
                    "hideZeros": false,
                    "mode": "single",
                    "sort": "none"
                }
            },
            "pluginVersion": "12.0.1",
            "targets": [
                {
                    "datasource": {
                        "type": "motherduck-duckdb-datasource",
                        "uid": "P18CE15CC9D3BAB28"
                    },
                    "editorMode": "code",
                    "format": 1,
                    "rawQuery": true,
                    "rawSql": "SELECT\r\n  time_bucket($__interval, processing_end) AS time,\r\n  CAST(SUM(total_rows) AS DOUBLE)       AS value\r\nFROM read_parquet(\r\n  '/data/history/processed/date=*/**/*.parquet',\r\n  union_by_name => TRUE\r\n)\r\nWHERE $__timeFilter(processing_end)\r\nGROUP BY 1\r\nORDER BY 1;\r\n",
                    "refId": "A",
                    "sql": {
                        "columns": [
                            {
                                "parameters": [],
                                "type": "function"
                            }
                        ],
                        "groupBy": [
                            {
                                "property": {
                                    "type": "string"
                                },
                                "type": "groupBy"
                            }
                        ],
                        "limit": 50
                    }
                }
            ],
            "title": "Data points Processed",
            "type": "timeseries"
        },
        {
            "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "palette-classic"
                    },
                    "custom": {
                        "axisBorderShow": false,
                        "axisCenteredZero": false,
                        "axisColorMode": "text",
                        "axisLabel": "",
                        "axisPlacement": "auto",
                        "barAlignment": 0,
                        "barWidthFactor": 0.6,
                        "drawStyle": "line",
                        "fillOpacity": 0,
                        "gradientMode": "none",
                        "hideFrom": {
                            "legend": false,
                            "tooltip": false,
                            "viz": false
                        },
                        "insertNulls": false,
                        "lineInterpolation": "linear",
                        "lineWidth": 1,
                        "pointSize": 5,
                        "scaleDistribution": {
                            "type": "linear"
                        },
                        "showPoints": "auto",
                        "spanNulls": false,
                        "stacking": {
                            "group": "A",
                            "mode": "none"
                        },
                        "thresholdsStyle": {
                            "mode": "off"
                        }
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green"
                            },
                            {
                                "color": "red",
                                "value": 80
                            }
                        ]
                    },
                    "unit": "percent"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 6,
                "w": 12,
                "x": 12,
                "y": 11
            },
            "id": 16,
            "options": {
                "legend": {
                    "calcs": [],
                    "displayMode": "list",
                    "placement": "bottom",
                    "showLegend": true
                },
                "tooltip": {
                    "hideZeros": false,
                    "mode": "single",
                    "sort": "none"
                }
            },
            "pluginVersion": "12.0.1",
            "targets": [
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "PBFA97CFB590B2093"
                    },
                    "editorMode": "code",
                    "expr": "100 * (1 - node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)\r\n",
                    "instant": false,
                    "legendFormat": "__auto",
                    "range": true,
                    "refId": "A"
                }
            ],
            "title": "Memory Utilisation",
            "type": "timeseries"
        },
        {
            "datasource": {
                "type": "motherduck-duckdb-datasource",
                "uid": "P18CE15CC9D3BAB28"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "palette-classic"
                    },
                    "custom": {
                        "axisBorderShow": false,
                        "axisCenteredZero": false,
                        "axisColorMode": "text",
                        "axisLabel": "",
                        "axisPlacement": "auto",
                        "barAlignment": 0,
                        "barWidthFactor": 0.6,
                        "drawStyle": "line",
                        "fillOpacity": 0,
                        "gradientMode": "none",
                        "hideFrom": {
                            "legend": false,
                            "tooltip": false,
                            "viz": false
                        },
                        "insertNulls": false,
                        "lineInterpolation": "linear",
                        "lineWidth": 1,
                        "pointSize": 5,
                        "scaleDistribution": {
                            "type": "linear"
                        },
                        "showPoints": "auto",
                        "spanNulls": false,
                        "stacking": {
                            "group": "A",
                            "mode": "none"
                        },
                        "thresholdsStyle": {
                            "mode": "off"
                        }
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green"
                            },
                            {
                                "color": "red",
                                "value": 80
                            }
                        ]
                    },
                    "unit": "decbytes"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 6,
                "w": 12,
                "x": 0,
                "y": 17
            },
            "id": 8,
            "options": {
                "legend": {
                    "calcs": [],
                    "displayMode": "list",
                    "placement": "bottom",
                    "showLegend": true
                },
                "tooltip": {
                    "hideZeros": false,
                    "mode": "single",
                    "sort": "none"
                }
            },
            "pluginVersion": "12.0.1",
            "targets": [
                {
                    "datasource": {
                        "type": "motherduck-duckdb-datasource",
                        "uid": "P18CE15CC9D3BAB28"
                    },
                    "editorMode": "code",
                    "format": 0,
                    "rawQuery": true,
                    "rawSql": "SELECT\r\n  time_bucket($__interval, download_end) AS time,\r\n  'Downloaded'                     AS metric,\r\n  CAST(SUM(size_bytes) AS DOUBLE)  AS value\r\nFROM read_parquet(\r\n  '/data/history/downloaded/date=*/**/*.parquet',\r\n  union_by_name => TRUE\r\n)\r\nWHERE $__timeFilter(download_end)\r\nGROUP BY 1\r\n\r\nUNION ALL\r\n\r\nSELECT\r\n  time_bucket($__interval, processing_end) AS time,\r\n  'Processed'                            AS metric,\r\n  CAST(SUM(size_bytes) AS DOUBLE)        AS value\r\nFROM read_parquet(\r\n  '/data/history/processed/date=*/**/*.parquet',\r\n  union_by_name => TRUE\r\n)\r\nWHERE $__timeFilter(processing_end)\r\nGROUP BY 1\r\n\r\nORDER BY time, metric;\r\n",
                    "refId": "A",
                    "sql": {
                        "columns": [
                            {
                                "parameters": [],
                                "type": "function"
                            }
                        ],
                        "groupBy": [
                            {
                                "property": {
                                    "type": "string"
                                },
                                "type": "groupBy"
                            }
                        ],
                        "limit": 50
                    }
                }
            ],
            "title": "Downloaded Input vs Processed Output",
            "type": "timeseries"
        },
        {
            "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "palette-classic"
                    },
                    "custom": {
                        "axisBorderShow": false,
                        "axisCenteredZero": false,
                        "axisColorMode": "text",
                        "axisLabel": "",
                        "axisPlacement": "auto",
                        "barAlignment": 0,
                        "barWidthFactor": 0.6,
                        "drawStyle": "line",
                        "fillOpacity": 0,
                        "gradientMode": "none",
                        "hideFrom": {
                            "legend": false,
                            "tooltip": false,
                            "viz": false
                        },
                        "insertNulls": false,
                        "lineInterpolation": "linear",
                        "lineWidth": 1,
                        "pointSize": 5,
                        "scaleDistribution": {
                            "type": "linear"
                        },
                        "showPoints": "auto",
                        "spanNulls": false,
                        "stacking": {
                            "group": "A",
                            "mode": "none"
                        },
                        "thresholdsStyle": {
                            "mode": "off"
                        }
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green"
                            },
                            {
                                "color": "red",
                                "value": 80
                            }
                        ]
                    },
                    "unit": "decbytes"
                },
                "overrides": []
            },
            "gridPos": {
                "h": 6,
                "w": 6,
                "x": 12,
                "y": 17
            },
            "id": 11,
            "options": {
                "legend": {
                    "calcs": [],
                    "displayMode": "list",
                    "placement": "bottom",
                    "showLegend": true
                },
                "tooltip": {
                    "hideZeros": false,
                    "mode": "single",
                    "sort": "none"
                }
            },
            "pluginVersion": "12.0.1",
            "targets": [
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "PBFA97CFB590B2093"
                    },
                    "editorMode": "code",
                    "expr": "assets_directory_size_bytes",
                    "instant": false,
                    "legendFormat": "__auto",
                    "range": true,
                    "refId": "A"
                }
            ],
            "title": "Asset Directory Size",
            "type": "timeseries"
        },
        {
            "datasource": {
                "type": "prometheus",
                "uid": "PBFA97CFB590B2093"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "palette-classic"
                    },
                    "custom": {
                        "axisBorderShow": false,
                        "axisCenteredZero": false,
                        "axisColorMode": "text",
                        "axisLabel": "",
                        "axisPlacement": "auto",
                        "barAlignment": 0,
                        "barWidthFactor": 0.6,
                        "drawStyle": "line",
                        "fillOpacity": 0,
                        "gradientMode": "none",
                        "hideFrom": {
                            "legend": false,
                            "tooltip": false,
                            "viz": false
                        },
                        "insertNulls": false,
                        "lineInterpolation": "linear",
                        "lineWidth": 1,
                        "pointSize": 5,
                        "scaleDistribution": {
                            "type": "linear"
                        },
                        "showPoints": "auto",
                        "spanNulls": false,
                        "stacking": {
                            "group": "A",
                            "mode": "none"
                        },
                        "thresholdsStyle": {
                            "mode": "off"
                        }
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green"
                            },
                            {
                                "color": "red",
                                "value": 80
                            }
                        ]
                    }
                },
                "overrides": []
            },
            "gridPos": {
                "h": 6,
                "w": 6,
                "x": 18,
                "y": 17
            },
            "id": 10,
            "options": {
                "legend": {
                    "calcs": [],
                    "displayMode": "list",
                    "placement": "bottom",
                    "showLegend": true
                },
                "tooltip": {
                    "hideZeros": false,
                    "mode": "single",
                    "sort": "none"
                }
            },
            "pluginVersion": "12.0.1",
            "targets": [
                {
                    "datasource": {
                        "type": "prometheus",
                        "uid": "PBFA97CFB590B2093"
                    },
                    "editorMode": "code",
                    "expr": "100 * (\r\n  node_filesystem_size_bytes{fstype!~\"tmpfs|overlay|aufs|squashfs|devtmpfs\"}\r\n  -\r\n  node_filesystem_avail_bytes{fstype!~\"tmpfs|overlay|aufs|squashfs|devtmpfs\"}\r\n)\r\n/\r\nnode_filesystem_size_bytes{fstype!~\"tmpfs|overlay|aufs|squashfs|devtmpfs\"}\r\n",
                    "instant": false,
                    "legendFormat": "__auto",
                    "range": true,
                    "refId": "A"
                }
            ],
            "title": "File system utilisation (all mounts)",
            "type": "timeseries"
        },
        {
            "datasource": {
                "type": "motherduck-duckdb-datasource",
                "uid": "P18CE15CC9D3BAB28"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "thresholds"
                    },
                    "custom": {
                        "align": "auto",
                        "cellOptions": {
                            "type": "auto"
                        },
                        "inspect": false
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green"
                            },
                            {
                                "color": "red",
                                "value": 80
                            }
                        ]
                    }
                },
                "overrides": [
                    {
                        "matcher": {
                            "id": "byName",
                            "options": "download_size_bytes"
                        },
                        "properties": [
                            {
                                "id": "unit",
                                "value": "decbytes"
                            }
                        ]
                    },
                    {
                        "matcher": {
                            "id": "byName",
                            "options": "processed_size_bytes"
                        },
                        "properties": [
                            {
                                "id": "unit",
                                "value": "decbytes"
                            }
                        ]
                    }
                ]
            },
            "gridPos": {
                "h": 11,
                "w": 24,
                "x": 0,
                "y": 23
            },
            "id": 12,
            "options": {
                "cellHeight": "sm",
                "footer": {
                    "countRows": false,
                    "fields": "",
                    "reducer": [
                        "sum"
                    ],
                    "show": false
                },
                "showHeader": true,
                "sortBy": [
                    {
                        "desc": true,
                        "displayName": "downloading_duration_seconds"
                    }
                ]
            },
            "pluginVersion": "12.0.1",
            "targets": [
                {
                    "datasource": {
                        "type": "motherduck-duckdb-datasource",
                        "uid": "P18CE15CC9D3BAB28"
                    },
                    "editorMode": "code",
                    "format": 1,
                    "rawQuery": true,
                    "rawSql": "SELECT\r\n  p.filename,\r\n  d.url,\r\n  d.download_start,\r\n  d.download_end,\r\n  p.processing_start,\r\n  p.processing_end,\r\n  d.size_bytes     AS download_size_bytes,\r\n  p.size_bytes     AS processed_size_bytes,\r\n  p.total_rows,\r\n  (DATEDIFF('microsecond', p.processing_start, p.processing_end) / 1e6) AS processing_duration_seconds,\r\n  (DATEDIFF('microsecond', d.download_start, d.download_end) / 1e6) AS downloading_duration_seconds\r\nFROM\r\n  read_parquet(\r\n    '/data/history/processed/date=*/**/*.parquet',\r\n    union_by_name => TRUE\r\n  ) AS p\r\nLEFT JOIN\r\n  read_parquet(\r\n    '/data/history/downloaded/date=*/**/*.parquet',\r\n    union_by_name => TRUE\r\n  ) AS d\r\n  ON p.filename = d.filename\r\nORDER BY\r\n  p.processing_end DESC;\r\n",
                    "refId": "A",
                    "sql": {
                        "columns": [
                            {
                                "parameters": [],
                                "type": "function"
                            }
                        ],
                        "groupBy": [
                            {
                                "property": {
                                    "type": "string"
                                },
                                "type": "groupBy"
                            }
                        ],
                        "limit": 50
                    }
                }
            ],
            "title": "Processed",
            "type": "table"
        },
        {
            "datasource": {
                "type": "motherduck-duckdb-datasource",
                "uid": "P18CE15CC9D3BAB28"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "thresholds"
                    },
                    "custom": {
                        "axisPlacement": "auto",
                        "fillOpacity": 70,
                        "hideFrom": {
                            "legend": false,
                            "tooltip": false,
                            "viz": false
                        },
                        "insertNulls": false,
                        "lineWidth": 0,
                        "spanNulls": false
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green"
                            }
                        ]
                    }
                },
                "overrides": []
            },
            "gridPos": {
                "h": 5,
                "w": 24,
                "x": 0,
                "y": 34
            },
            "id": 13,
            "options": {
                "alignValue": "left",
                "legend": {
                    "displayMode": "list",
                    "placement": "bottom",
                    "showLegend": false
                },
                "mergeValues": true,
                "rowHeight": 0.9,
                "showValue": "auto",
                "tooltip": {
                    "hideZeros": false,
                    "mode": "single",
                    "sort": "none"
                }
            },
            "pluginVersion": "12.0.1",
            "targets": [
                {
                    "datasource": {
                        "type": "motherduck-duckdb-datasource",
                        "uid": "P18CE15CC9D3BAB28"
                    },
                    "editorMode": "code",
                    "format": 1,
                    "rawQuery": true,
                    "rawSql": "-- Dense time series for Grafana State Timeline with 8 threads.\r\nWITH downloads AS (\r\n  SELECT\r\n    download_start,\r\n    download_end,\r\n    thread,\r\n    filename\r\n  FROM\r\n    read_parquet(\r\n      '/data/history/downloaded/date=*/**/*.parquet',\r\n      union_by_name => TRUE\r\n    )\r\n  WHERE\r\n    $__timeFilter(download_end)\r\n  ORDER BY\r\n    download_end DESC\r\n  LIMIT\r\n    5000\r\n),\r\ntimeline AS (\r\n  SELECT DISTINCT ts\r\n  FROM (\r\n    SELECT download_start AS ts FROM downloads\r\n    UNION\r\n    SELECT download_end   AS ts FROM downloads\r\n  )\r\n)\r\nSELECT\r\n  t.ts AS \"time\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 1) AS \"Downloader 1\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 2) AS \"Downloader 2\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 3) AS \"Downloader 3\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 4) AS \"Downloader 4\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 5) AS \"Downloader 5\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 6) AS \"Downloader 6\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 7) AS \"Downloader 7\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 8) AS \"Downloader 8\"\r\nFROM\r\n  timeline t\r\n  LEFT JOIN downloads d\r\n    ON t.ts >= d.download_start\r\n   AND t.ts <  d.download_end\r\nGROUP BY\r\n  t.ts\r\nORDER BY\r\n  t.ts;\r\n",
                    "refId": "A",
                    "sql": {
                        "columns": [
                            {
                                "parameters": [],
                                "type": "function"
                            }
                        ],
                        "groupBy": [
                            {
                                "property": {
                                    "type": "string"
                                },
                                "type": "groupBy"
                            }
                        ],
                        "limit": 50
                    }
                }
            ],
            "title": "Downloads per thread (limited to 5k)",
            "transformations": [
                {
                    "id": "renameByRegex",
                    "options": {
                        "regex": "^A$",
                        "renamePattern": "Value"
                    }
                }
            ],
            "type": "state-timeline"
        },
        {
            "datasource": {
                "type": "motherduck-duckdb-datasource",
                "uid": "P18CE15CC9D3BAB28"
            },
            "fieldConfig": {
                "defaults": {
                    "color": {
                        "mode": "thresholds"
                    },
                    "custom": {
                        "axisPlacement": "auto",
                        "fillOpacity": 70,
                        "hideFrom": {
                            "legend": false,
                            "tooltip": false,
                            "viz": false
                        },
                        "insertNulls": false,
                        "lineWidth": 0,
                        "spanNulls": false
                    },
                    "mappings": [],
                    "thresholds": {
                        "mode": "absolute",
                        "steps": [
                            {
                                "color": "green"
                            },
                            {
                                "color": "red",
                                "value": 80
                            }
                        ]
                    }
                },
                "overrides": []
            },
            "gridPos": {
                "h": 24,
                "w": 24,
                "x": 0,
                "y": 39
            },
            "id": 14,
            "options": {
                "alignValue": "left",
                "legend": {
                    "displayMode": "list",
                    "placement": "bottom",
                    "showLegend": false
                },
                "mergeValues": true,
                "rowHeight": 0.9,
                "showValue": "auto",
                "tooltip": {
                    "hideZeros": false,
                    "mode": "single",
                    "sort": "none"
                }
            },
            "pluginVersion": "12.0.1",
            "targets": [
                {
                    "datasource": {
                        "type": "motherduck-duckdb-datasource",
                        "uid": "P18CE15CC9D3BAB28"
                    },
                    "editorMode": "code",
                    "format": 1,
                    "rawQuery": true,
                    "rawSql": "-- This query creates a dense time series for processed files, suitable for Grafana's State Timeline panel.\r\n-- It generates a row for every start/end event and shows the state of each processing thread at that exact moment.\r\n\r\n-- Step 1: Define a CTE for the raw processing data. This now selects only the 1000 most recent\r\n-- events within Grafana's time range to improve performance.\r\nWITH processed_data AS (\r\n  SELECT\r\n    *\r\n  FROM\r\n    (\r\n      SELECT\r\n        processing_start,\r\n        processing_end,\r\n        thread,\r\n        filename\r\n      FROM\r\n        read_parquet(\r\n          '/data/history/processed/date=*/**/*.parquet',\r\n          union_by_name => TRUE\r\n        )\r\n      WHERE\r\n        $__timeFilter(processing_end)\r\n      ORDER BY\r\n        processing_end DESC\r\n      LIMIT\r\n        5000\r\n    )\r\n),\r\n-- Step 2: Create a master timeline of all unique timestamps where a state could change.\r\ntimeline AS (\r\n  SELECT DISTINCT\r\n    ts\r\n  FROM\r\n    (\r\n      SELECT\r\n        processing_start AS ts\r\n      FROM\r\n        processed_data\r\n      UNION\r\n      SELECT\r\n        processing_end AS ts\r\n      FROM\r\n        processed_data\r\n    )\r\n)\r\n-- Step 3: Join the master timeline with the processing events and pivot the data.\r\n-- For each timestamp in our timeline, we find the active file for each processing thread.\r\nSELECT\r\n  t.ts AS \"time\",\r\n  -- For each thread, find the filename where the current timestamp falls between\r\n  -- the processing_start and processing_end time. If no file is active, it will be NULL.\r\n  MAX(d.filename) FILTER (WHERE d.thread = 1) AS \"Processor 1\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 2) AS \"Processor 2\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 3) AS \"Processor 3\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 4) AS \"Processor 4\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 5) AS \"Processor 5\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 6) AS \"Processor 6\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 7) AS \"Processor 7\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 8) AS \"Processor 8\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 9) AS \"Processor 9\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 10) AS \"Processor 10\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 11) AS \"Processor 11\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 12) AS \"Processor 12\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 13) AS \"Processor 13\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 14) AS \"Processor 14\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 15) AS \"Processor 15\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 16) AS \"Processor 16\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 17) AS \"Processor 17\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 18) AS \"Processor 18\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 19) AS \"Processor 19\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 20) AS \"Processor 20\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 21) AS \"Processor 21\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 22) AS \"Processor 22\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 23) AS \"Processor 23\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 24) AS \"Processor 24\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 25) AS \"Processor 25\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 26) AS \"Processor 26\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 27) AS \"Processor 27\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 28) AS \"Processor 28\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 29) AS \"Processor 29\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 30) AS \"Processor 30\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 31) AS \"Processor 31\",\r\n  MAX(d.filename) FILTER (WHERE d.thread = 32) AS \"Processor 32\"\r\nFROM\r\n  timeline t\r\n  -- A LEFT JOIN finds all processing jobs that were active at the timestamp 't.ts'.\r\n  LEFT JOIN processed_data d ON t.ts >= d.processing_start\r\n  AND t.ts < d.processing_end\r\nGROUP BY\r\n  t.ts\r\nORDER BY\r\n  t.ts;\r\n",
                    "refId": "A",
                    "sql": {
                        "columns": [
                            {
                                "parameters": [],
                                "type": "function"
                            }
                        ],
                        "groupBy": [
                            {
                                "property": {
                                    "type": "string"
                                },
                                "type": "groupBy"
                            }
                        ],
                        "limit": 50
                    }
                }
            ],
            "title": "Processed Files per core (limited to 5k)",
            "type": "state-timeline"
        }
    ],
    "preload": false,
    "refresh": "5s",
    "schemaVersion": 41,
    "tags": [],
    "templating": {
        "list": []
    },
    "time": {
        "from": "2025-06-02T09:09:39.730Z",
        "to": "2025-06-02T11:42:27.072Z"
    },
    "timepicker": {},
    "timezone": "browser",
    "title": "File Stats",
    "uid": "a78f110c-caac-4f47-96d3-5772ce7d2120",
    "version": 1
}